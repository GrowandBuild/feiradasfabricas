<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Algoritmo de Variações</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <meta name="csrf-token" content="test-token">
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card border-0 shadow-lg rounded-4">
                    <div class="card-body p-5">
                        <h1 class="text-center mb-4 fw-bold">
                            <i class="bi bi-gear text-primary me-2"></i>
                            Test Algoritmo de Variações
                        </h1>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card border-0 bg-light">
                                    <div class="card-body">
                                        <h6 class="fw-bold">Teste 1: Atributo Único</h6>
                                        <button class="btn btn-primary btn-sm" onclick="testSingleAttribute()">Testar</button>
                                        <div id="result1" class="mt-2"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-0 bg-light">
                                    <div class="card-body">
                                        <h6 class="fw-bold">Teste 2: Múltiplos Atributos</h6>
                                        <button class="btn btn-primary btn-sm" onclick="testMultipleAttributes()">Testar</button>
                                        <div id="result2" class="mt-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card border-0 bg-light">
                                    <div class="card-body">
                                        <h6 class="fw-bold">Teste 3: Atributos com Preço/Estoque</h6>
                                        <button class="btn btn-primary btn-sm" onclick="testWithPriceStock()">Testar</button>
                                        <div id="result3" class="mt-2"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-0 bg-light">
                                    <div class="card-body">
                                        <h6 class="fw-bold">Teste 4: Sem Atributos</h6>
                                        <button class="btn btn-primary btn-sm" onclick="testNoAttributes()">Testar</button>
                                        <div id="result4" class="mt-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card border-0 bg-success bg-opacity-10">
                            <div class="card-body">
                                <h6 class="fw-bold text-success">Resultados Completos</h6>
                                <div id="completeResults" class="font-monospace small"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Implementação do algoritmo corrigido
    class SimpleVariationGenerator {
        cartesianProduct(arrays) {
            if (arrays.length === 0) return [[]];
            if (arrays.length === 1) return arrays[0].map(item => [item]);
            
            const [first, ...rest] = arrays;
            const restProduct = this.cartesianProduct(rest);
            
            const result = [];
            first.forEach(item => {
                restProduct.forEach(combo => {
                    result.push([item, ...combo]);
                });
            });
            
            return result;
        }

        generateCombinations(attributes, price = 0, stock = 0) {
            // Arrays de valores por atributo
            const arrays = attributes.map(attr => {
                const values = attr.values.map(value => ({ 
                    [attr.name]: value 
                }));
                return values;
            });

            // Gerar combinações (produto cartesiano)
            const combinations = this.cartesianProduct(arrays);

            return combinations.map(combo => {
                const variation = {};
                // Handle case where combo might be a single object (when only one attribute)
                const items = Array.isArray(combo) ? combo : [combo];
                items.forEach(item => {
                    Object.assign(variation, item);
                });
                
                // Adicionar campos comuns
                if (price > 0) variation.price = price;
                if (stock > 0) variation.stock_quantity = stock;
                
                return variation;
            });
        }
    }

    const generator = new SimpleVariationGenerator();

    function testSingleAttribute() {
        console.log('=== Teste 1: Atributo Único ===');
        const attributes = [
            { name: 'cor', values: ['azul', 'verde', 'preto'] }
        ];
        
        try {
            const result = generator.generateCombinations(attributes);
            console.log('Resultado:', result);
            
            document.getElementById('result1').innerHTML = `
                <div class="alert alert-success">
                    <strong>Sucesso!</strong> ${result.length} variações geradas<br>
                    <small>${JSON.stringify(result, null, 2)}</small>
                </div>
            `;
            
            updateCompleteResults('Teste 1 - Atributo Único', result);
        } catch (error) {
            console.error('Erro:', error);
            document.getElementById('result1').innerHTML = `
                <div class="alert alert-danger">
                    <strong>Erro:</strong> ${error.message}
                </div>
            `;
        }
    }

    function testMultipleAttributes() {
        console.log('=== Teste 2: Múltiplos Atributos ===');
        const attributes = [
            { name: 'cor', values: ['azul', 'preto'] },
            { name: 'tamanho', values: ['P', 'M', 'G'] }
        ];
        
        try {
            const result = generator.generateCombinations(attributes);
            console.log('Resultado:', result);
            
            document.getElementById('result2').innerHTML = `
                <div class="alert alert-success">
                    <strong>Sucesso!</strong> ${result.length} variações geradas<br>
                    <small>${JSON.stringify(result, null, 2)}</small>
                </div>
            `;
            
            updateCompleteResults('Teste 2 - Múltiplos Atributos', result);
        } catch (error) {
            console.error('Erro:', error);
            document.getElementById('result2').innerHTML = `
                <div class="alert alert-danger">
                    <strong>Erro:</strong> ${error.message}
                </div>
            `;
        }
    }

    function testWithPriceStock() {
        console.log('=== Teste 3: Com Preço e Estoque ===');
        const attributes = [
            { name: 'cor', values: ['vermelho', 'azul'] },
            { name: 'tamanho', values: ['M'] }
        ];
        
        try {
            const result = generator.generateCombinations(attributes, 199.90, 15);
            console.log('Resultado:', result);
            
            document.getElementById('result3').innerHTML = `
                <div class="alert alert-success">
                    <strong>Sucesso!</strong> ${result.length} variações geradas<br>
                    <small>${JSON.stringify(result, null, 2)}</small>
                </div>
            `;
            
            updateCompleteResults('Teste 3 - Com Preço/Estoque', result);
        } catch (error) {
            console.error('Erro:', error);
            document.getElementById('result3').innerHTML = `
                <div class="alert alert-danger">
                    <strong>Erro:</strong> ${error.message}
                </div>
            `;
        }
    }

    function testNoAttributes() {
        console.log('=== Teste 4: Sem Atributos ===');
        const attributes = [];
        
        try {
            const result = generator.generateCombinations(attributes);
            console.log('Resultado:', result);
            
            document.getElementById('result4').innerHTML = `
                <div class="alert alert-success">
                    <strong>Sucesso!</strong> ${result.length} variações geradas<br>
                    <small>${JSON.stringify(result, null, 2)}</small>
                </div>
            `;
            
            updateCompleteResults('Teste 4 - Sem Atributos', result);
        } catch (error) {
            console.error('Erro:', error);
            document.getElementById('result4').innerHTML = `
                <div class="alert alert-danger">
                    <strong>Erro:</strong> ${error.message}
                </div>
            `;
        }
    }

    function updateCompleteResults(testName, result) {
        const completeResults = document.getElementById('completeResults');
        const timestamp = new Date().toLocaleTimeString();
        
        completeResults.innerHTML += `
            <div class="mb-3">
                <strong>[${timestamp}] ${testName}</strong><br>
                Total: ${result.length} variações<br>
                <pre class="bg-white p-2 rounded small">${JSON.stringify(result, null, 2)}</pre>
            </div>
        `;
    }

    // Executar testes automaticamente
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Página de teste carregada');
        
        setTimeout(() => {
            testSingleAttribute();
            setTimeout(() => testMultipleAttributes(), 1000);
            setTimeout(() => testWithPriceStock(), 2000);
            setTimeout(() => testNoAttributes(), 3000);
        }, 500);
    });
    </script>
</body>
</html>
